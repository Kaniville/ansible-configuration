---
- name: Generate USBGuard rules
  ansible.builtin.shell: "usbguard generate-policy > /etc/usbguard/rules.conf"
  when: "'/etc/usbguard/rules.conf' is not file"

- name: Add wheel group to usbguard
  ansible.builtin.lineinfile:
    path: /etc/usbguard/usbguard-daemon.conf
    state: present
    regexp: '^IPCAllowedGroups='
    line: 'IPCAllowedGroups=wheel'
  when: "'/etc/usbguard/rules.conf' is file"